description: >
  Pushing a standard node project to your repo.
  Use the "setup" command to install and authenticate with your account.
  Use the "push" command to package and push the current project to your repo
usage:
  version: 2.1
  orbs:
    altostra-orb: circleci/altostra@x.y
  jobs:
    build-and-push:
      docker:
        - image: circleci/node:12.13
      working_directory: ~/repo

      steps:
        - checkout

        # Download and cache dependencies
        - restore_cache:
          keys:
          - v1-dependencies-
          # fallback to using the latest cache if no exact match is found
          - v1-dependencies-

        - altostra/setup:
          api-key: "$ALTO_API_KEY"

        - install:
          name: Install node modules
          command: |
            npm install

        - save_cache:
          paths:
            - node_modules
          key: v1-dependencies-

        # run tests! - you can add this step to match your tests.
        # - run:
        #     name: Run tests with coverage
        #     command: npm test --coverage

        - altostra/push:
          version: v$(node -p -e "require('./package.json').version")

  workflows:
    push:
      jobs:
        - deploy
